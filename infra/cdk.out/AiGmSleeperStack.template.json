{
 "Resources": {
  "SleeperDataBucket49FED3F2": {
   "Type": "AWS::S3::Bucket",
   "Properties": {
    "BucketEncryption": {
     "ServerSideEncryptionConfiguration": [
      {
       "ServerSideEncryptionByDefault": {
        "SSEAlgorithm": "AES256"
       }
      }
     ]
    },
    "LifecycleConfiguration": {
     "Rules": [
      {
       "Id": "expire-old-versions",
       "NoncurrentVersionExpiration": {
        "NoncurrentDays": 90
       },
       "Status": "Enabled"
      }
     ]
    },
    "PublicAccessBlockConfiguration": {
     "BlockPublicAcls": true,
     "BlockPublicPolicy": true,
     "IgnorePublicAcls": true,
     "RestrictPublicBuckets": true
    },
    "VersioningConfiguration": {
     "Status": "Enabled"
    }
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/SleeperDataBucket/Resource"
   }
  },
  "PlayersSyncFnServiceRoleBADCA420": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/PlayersSyncFn/ServiceRole/Resource"
   }
  },
  "PlayersSyncFnServiceRoleDefaultPolicy00649A74": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:GetObject*",
        "s3:GetBucket*",
        "s3:List*",
        "s3:DeleteObject*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging",
        "s3:Abort*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SleeperDataBucket49FED3F2",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SleeperDataBucket49FED3F2",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PlayersSyncFnServiceRoleDefaultPolicy00649A74",
    "Roles": [
     {
      "Ref": "PlayersSyncFnServiceRoleBADCA420"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/PlayersSyncFn/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "PlayersSyncFn64102A61": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Architectures": [
     "arm64"
    ],
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-484908222088-us-east-2",
     "S3Key": "01d908f7f0710252d9764c1d843c532e850c0caf918b0cd99e5315576f0e1e13.zip"
    },
    "Environment": {
     "Variables": {
      "S3_BUCKET": {
       "Ref": "SleeperDataBucket49FED3F2"
      },
      "PLAYERS_S3_PREFIX": "sleeper/players",
      "ROSTER_S3_PREFIX": "sleeper_sync",
      "PLAYERS_CACHE_PATH": "/tmp/players_nfl.json"
     }
    },
    "Handler": "sleeper_sync.players_lambda_handler",
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "PlayersSyncFnServiceRoleBADCA420",
      "Arn"
     ]
    },
    "Runtime": "python3.12",
    "Timeout": 120
   },
   "DependsOn": [
    "PlayersSyncFnServiceRoleDefaultPolicy00649A74",
    "PlayersSyncFnServiceRoleBADCA420"
   ],
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/PlayersSyncFn/Resource",
    "aws:asset:path": "asset.01d908f7f0710252d9764c1d843c532e850c0caf918b0cd99e5315576f0e1e13",
    "aws:asset:is-bundled": true,
    "aws:asset:property": "Code"
   }
  },
  "PlayersSyncFnLogRetentionDFC4C1E0": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "PlayersSyncFn64102A61"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/PlayersSyncFn/LogRetention/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:PutRetentionPolicy",
        "logs:DeleteRetentionPolicy"
       ],
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
    "Roles": [
     {
      "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Handler": "index.handler",
    "Runtime": "nodejs22.x",
    "Timeout": 900,
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-484908222088-us-east-2",
     "S3Key": "2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d.zip"
    },
    "Role": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"
   ],
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource",
    "aws:asset:path": "asset.2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "RosterSyncFnServiceRole129EFEB7": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/RosterSyncFn/ServiceRole/Resource"
   }
  },
  "RosterSyncFnServiceRoleDefaultPolicyD7A2BFA4": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "s3:GetObject*",
        "s3:GetBucket*",
        "s3:List*",
        "s3:DeleteObject*",
        "s3:PutObject",
        "s3:PutObjectLegalHold",
        "s3:PutObjectRetention",
        "s3:PutObjectTagging",
        "s3:PutObjectVersionTagging",
        "s3:Abort*"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "SleeperDataBucket49FED3F2",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "SleeperDataBucket49FED3F2",
             "Arn"
            ]
           },
           "/*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "RosterSyncFnServiceRoleDefaultPolicyD7A2BFA4",
    "Roles": [
     {
      "Ref": "RosterSyncFnServiceRole129EFEB7"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/RosterSyncFn/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "RosterSyncFn215FEF8F": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Architectures": [
     "arm64"
    ],
    "Code": {
     "S3Bucket": "cdk-hnb659fds-assets-484908222088-us-east-2",
     "S3Key": "01d908f7f0710252d9764c1d843c532e850c0caf918b0cd99e5315576f0e1e13.zip"
    },
    "Environment": {
     "Variables": {
      "S3_BUCKET": {
       "Ref": "SleeperDataBucket49FED3F2"
      },
      "PLAYERS_S3_PREFIX": "sleeper/players",
      "ROSTER_S3_PREFIX": "sleeper_sync",
      "PLAYERS_CACHE_PATH": "/tmp/players_nfl.json",
      "USE_S3_PLAYERS": "1"
     }
    },
    "Handler": "sleeper_sync.roster_lambda_handler",
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "RosterSyncFnServiceRole129EFEB7",
      "Arn"
     ]
    },
    "Runtime": "python3.12",
    "Timeout": 60
   },
   "DependsOn": [
    "RosterSyncFnServiceRoleDefaultPolicyD7A2BFA4",
    "RosterSyncFnServiceRole129EFEB7"
   ],
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/RosterSyncFn/Resource",
    "aws:asset:path": "asset.01d908f7f0710252d9764c1d843c532e850c0caf918b0cd99e5315576f0e1e13",
    "aws:asset:is-bundled": true,
    "aws:asset:property": "Code"
   }
  },
  "RosterSyncFnLogRetentionD44960B0": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "RosterSyncFn215FEF8F"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/RosterSyncFn/LogRetention/Resource"
   }
  },
  "PlayersSchedulerRoleDDA4B1EE": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "scheduler.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/PlayersSchedulerRole/Resource"
   }
  },
  "PlayersSchedulerRoleDefaultPolicyB83BB1A4": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "PlayersSyncFn64102A61",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "PlayersSyncFn64102A61",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PlayersSchedulerRoleDefaultPolicyB83BB1A4",
    "Roles": [
     {
      "Ref": "PlayersSchedulerRoleDDA4B1EE"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/PlayersSchedulerRole/DefaultPolicy/Resource"
   }
  },
  "PlayersDailySchedule": {
   "Type": "AWS::Scheduler::Schedule",
   "Properties": {
    "Description": "Daily Sleeper players map sync (timezone aware)",
    "FlexibleTimeWindow": {
     "Mode": "OFF"
    },
    "ScheduleExpression": "cron(5 6 * * ? *)",
    "ScheduleExpressionTimezone": "America/Los_Angeles",
    "Target": {
     "Arn": {
      "Fn::GetAtt": [
       "PlayersSyncFn64102A61",
       "Arn"
      ]
     },
     "Input": "{}",
     "RoleArn": {
      "Fn::GetAtt": [
       "PlayersSchedulerRoleDDA4B1EE",
       "Arn"
      ]
     }
    }
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/PlayersDailySchedule"
   }
  },
  "RosterSchedulerRole5360B5C7": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "scheduler.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/RosterSchedulerRole/Resource"
   }
  },
  "RosterSchedulerRoleDefaultPolicy7E8A5031": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "RosterSyncFn215FEF8F",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "RosterSyncFn215FEF8F",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "RosterSchedulerRoleDefaultPolicy7E8A5031",
    "Roles": [
     {
      "Ref": "RosterSchedulerRole5360B5C7"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/RosterSchedulerRole/DefaultPolicy/Resource"
   }
  },
  "RosterEveryNMinutes": {
   "Type": "AWS::Scheduler::Schedule",
   "Properties": {
    "Description": "Roster sync every 10 minutes",
    "FlexibleTimeWindow": {
     "Mode": "OFF"
    },
    "ScheduleExpression": "rate(10 minutes)",
    "Target": {
     "Arn": {
      "Fn::GetAtt": [
       "RosterSyncFn215FEF8F",
       "Arn"
      ]
     },
     "Input": "{\"username\":\"tyler48\",\"season\":2025}",
     "RoleArn": {
      "Fn::GetAtt": [
       "RosterSchedulerRole5360B5C7",
       "Arn"
      ]
     }
    }
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/RosterEveryNMinutes"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/zWPTW6DMBCFz8LeTAzpIt21QeqqUiM4QDQxAzgYGzF2oghx98pAVt+8eU/zk8OcZznIBJ+cqrpPjb7BXHlUvcAnX2c+wnwOqicvisbu1YYzMi1C4wBz6QxFf+XFGa1eUW7VIvh4RWbyDN8RwuBwqxGKxv4Eq7x2VhjXMvy6tiRPdu2w6qgOhqaYq3axiJLYhUmRWEdVHltt23X32yga+xf8GPwiso9PkCmasUOQydf+5CFyuyEdX75zdo9cVvG+aRHW1QR3PjxyCdkJZHJnrdMpWK8HgnLjPzTgvQRDAQAA"
   },
   "Metadata": {
    "aws:cdk:path": "AiGmSleeperStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "BucketName": {
   "Value": {
    "Ref": "SleeperDataBucket49FED3F2"
   }
  },
  "PlayersFnName": {
   "Value": {
    "Ref": "PlayersSyncFn64102A61"
   }
  },
  "RosterFnName": {
   "Value": {
    "Ref": "RosterSyncFn215FEF8F"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}